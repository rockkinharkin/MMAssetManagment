!function(c){window.llms=window.llms||{},window.llms.metabox_product=function(){this.temp_id=Math.floor(7777*Math.random()+777),this.init=function(){this.bind_visibility();var e=c("#lifterlms-product #llms-product-options-access-plans");if(e.length){LLMS.Spinner.start(e);var l,t=this,a=0;l=setInterval(function(){if(300<=a)e.html(LLMS.l10n.translate("There was an error loading the necessary resources. Please try again."));else{if("undefined"==typeof tinyMCE)return void a++;t.bind()}clearInterval(l),LLMS.Spinner.stop(e)},100)}},this.bind=function(){var t=this;c("#llms-save-access-plans").on("click",function(){c("#publish").trigger("click")}),c("#llms-access-plans").on("change","[data-controller-id]",function(){t.controller_change(c(this))}),c("#llms-access-plans .llms-access-plan-datepicker").datepicker({dateFormat:"mm/dd/yy"}),c("#llms-access-plans [data-controller-id]").trigger("change"),c("#llms-new-access-plan").on("click",function(){var e=c(this);t.init_plan(),e.attr("disabled","disabled"),setTimeout(function(){e.removeAttr("disabled")},500)}),c("#llms-access-plans").sortable({handle:".llms-drag-handle",items:".llms-access-plan",start:function(e,l){c("#llms-access-plans").addClass("dragging")},stop:function(e,l){c("#llms-access-plans").removeClass("dragging"),t.update_plan_orders()}}),c("#llms-access-plans").on("keyup","input.llms-plan-title",function(){var e=c(this),l=e.closest(".llms-access-plan").find("span.llms-plan-title"),t=e.val(),a=t||l.attr("data-default");l.text(a)}),c("#llms-access-plans").on("click",".llms-plan-delete",function(e){e.stopPropagation(),t.delete_plan(c(this))}),window.llms.metaboxes.post_select(c("#llms-access-plans .llms-availability-restrictions")),c("#_llms_plans_content_llms-new-access-plan-model").attr("disabled","disabled"),tinyMCE.EditorManager.execCommand("mceRemoveEditor",!0,"_llms_plans_content_llms-new-access-plan-model"),c("#publish").on("click",function(e){c("#llms-access-plans input").each(function(){if(c(this).is(":invalid")){var e=c(this).closest(".llms-access-plan");return e.hasClass("opened")||e.find(".llms-collapsible-header").trigger("click"),!1}})})},this.bind_visibility=function(){var l=c("#llms-catalog-visibility-select"),t=c("a.llms-edit-catalog-visibility"),e=c("a.llms-save-catalog-visibility"),a=c("a.llms-cancel-catalog-visibility");t.on("click",function(e){e.preventDefault(),l.slideDown("fast"),t.hide()}),e.on("click",function(e){e.preventDefault(),l.slideUp("fast"),t.show(),c("#llms-catalog-visibility-display").text(c('input[name="_llms_visibility"]:checked').attr("data-label"))}),a.on("click",function(e){e.preventDefault(),l.slideUp("fast"),t.show()})},this.delete_plan=function(e){var l=this,t=e.closest(".llms-access-plan"),a=t.attr("data-id");a?c("#llms-delete-plan-modal").topModal({open:function(){c("#llms-confirm-delete-plan").on("click",function(){LLMS.Spinner.start(t,"small"),c("#llms-delete-plan-modal .topModalClose").trigger("click"),window.LLMS.Ajax.call({data:{action:"delete_access_plan",plan_id:a},success:function(e){LLMS.Spinner.stop(t),e.success?l.remove_plan_el(t):e.message&&alert(e.message)}})})},closed:function(){c("#llms-delete-plan-modal").attr("data-plan-id",""),c("#llms-confirm-delete-plan").off("click")}}).attr("data-plan-id",a):l.remove_plan_el(t)},this.controller_change=function(e){var l=e.attr("data-controller-id"),i=e.val(),t=e.closest(".llms-access-plan").find('[data-controller="'+l+'"]');"checkbox"===e.attr("type")&&(i=e.is(":checked")?i:"no"),t.each(function(){var e,l,t=c(this),a="SELECT"===t[0].nodeName||"INPUT"===t[0].nodeName||"TEXTAREA"===t[0].nodeName?t:t.find("input, select, textarea"),s=t.attr("data-value-is"),n=t.attr("data-value-is-not");switch(void 0!==s&&!1!==s?l="==":void 0!==n&&!1!==n&&(l="!="),l){case"==":e=i==s?"show":"hide";break;case"!=":e=i!=n?"show":"hide"}"show"===e?(t.show(),a.removeAttr("disabled").trigger("change")):"hide"===e&&(t.hide(),a.attr("disabled","disabled"))})},this.has_plan_limit_been_reached=function(){return window.llms.product.access_plan_limit<=c("#llms-access-plans .llms-access-plan").length},this.init_plan=function(){if(!this.has_plan_limit_been_reached()){var e=c("#llms-new-access-plan-model").clone();$existing_plans=c("#llms-access-plans .llms-access-plan"),$editor=e.find("#_llms_plans_content_llms-new-access-plan-model"),e.removeAttr("id"),$editor.removeAttr("id").attr("id","_llms_plans_content_"+this.temp_id),this.temp_id++,e.find("select, input, textarea").each(function(){c(this).removeAttr("disabled")}),e.find(".llms-access-plan-datepicker").datepicker({dateFormat:"mm/dd/yy"}),e.appendTo("#llms-access-plans"),this.update_plan_orders(),e.find(".llms-collapsible-header").trigger("click"),this.has_plan_limit_been_reached()&&this.toggle_create_button("disable"),window.llms.metaboxes.post_select(e.find(".llms-availability-restrictions")),e.find("[data-controller-id]").trigger("change")}},this.toggle_create_button=function(e){var l=c("#llms-new-access-plan"),t=l.next("p");"disable"===e?(l.attr("disabled","disabled"),t.show()):(l.removeAttr("disabled"),t.hide())},this.remove_plan_el=function(e){var l=this;e.fadeOut(400),setTimeout(function(){e.remove(),l.has_plan_limit_been_reached()||l.toggle_create_button("enable")},450)},this.update_plan_orders=function(){c("#llms-access-plans .llms-access-plan").each(function(){var e=c(this),l=e.find(".plan-order"),t=e.find('textarea[id^="_llms_plans_content_"]').attr("id"),a=1*l.val(),s=e.index();tinyMCE.EditorManager.execCommand("mceRemoveEditor",!0,t),e.find("select, input, textarea").each(function(){var e=c(this).attr("name");e&&c(this).attr("name",e.replace(a,s))}),tinyMCE.EditorManager.execCommand("mceAddEditor",!0,t),l.val(s)})},this.init()};new window.llms.metabox_product}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtbWV0YWJveC1wcm9kdWN0LmpzIl0sIm5hbWVzIjpbIiQiLCJ3aW5kb3ciLCJsbG1zIiwibWV0YWJveF9wcm9kdWN0IiwidGhpcyIsInRlbXBfaWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJpbml0IiwiYmluZF92aXNpYmlsaXR5IiwiJG1iIiwibGVuZ3RoIiwiTExNUyIsIlNwaW5uZXIiLCJzdGFydCIsImludGVydmFsIiwic2VsZiIsImNvdW50ZXIiLCJzZXRJbnRlcnZhbCIsImh0bWwiLCJsMTBuIiwidHJhbnNsYXRlIiwidGlueU1DRSIsImJpbmQiLCJjbGVhckludGVydmFsIiwic3RvcCIsIm9uIiwidHJpZ2dlciIsImNvbnRyb2xsZXJfY2hhbmdlIiwiZGF0ZXBpY2tlciIsImRhdGVGb3JtYXQiLCIkZWwiLCJpbml0X3BsYW4iLCJhdHRyIiwic2V0VGltZW91dCIsInJlbW92ZUF0dHIiLCJzb3J0YWJsZSIsImhhbmRsZSIsIml0ZW1zIiwiZXZlbnQiLCJ1aSIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJ1cGRhdGVfcGxhbl9vcmRlcnMiLCIkaW5wdXQiLCIkZGlzcGxheSIsImNsb3Nlc3QiLCJmaW5kIiwidmFsIiwidGl0bGUiLCJ0ZXh0IiwiZSIsInN0b3BQcm9wYWdhdGlvbiIsImRlbGV0ZV9wbGFuIiwibWV0YWJveGVzIiwicG9zdF9zZWxlY3QiLCJFZGl0b3JNYW5hZ2VyIiwiZXhlY0NvbW1hbmQiLCJlYWNoIiwiaXMiLCIkcGxhbiIsImhhc0NsYXNzIiwiJHJhZGlvcyIsIiR0b2dnbGUiLCIkc2F2ZSIsIiRjYW5jZWwiLCJwcmV2ZW50RGVmYXVsdCIsInNsaWRlRG93biIsImhpZGUiLCJzbGlkZVVwIiwic2hvdyIsIiRidG4iLCJwbGFuX2lkIiwidG9wTW9kYWwiLCJvcGVuIiwiQWpheCIsImNhbGwiLCJkYXRhIiwiYWN0aW9uIiwic3VjY2VzcyIsInIiLCJyZW1vdmVfcGxhbl9lbCIsIm1lc3NhZ2UiLCJhbGVydCIsImNsb3NlZCIsIm9mZiIsImlkIiwiJGNvbnRyb2xzIiwib3BlcmF0b3IiLCIkYyIsIiRlbHMiLCJub2RlTmFtZSIsImVxdWFscyIsIm5vdF9lcXVhbHMiLCJoYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQiLCJwcm9kdWN0IiwiYWNjZXNzX3BsYW5fbGltaXQiLCIkY2xvbmUiLCJjbG9uZSIsIiRleGlzdGluZ19wbGFucyIsIiRlZGl0b3IiLCJhcHBlbmRUbyIsInRvZ2dsZV9jcmVhdGVfYnV0dG9uIiwic3RhdHVzIiwiJG1zZyIsIm5leHQiLCJmYWRlT3V0IiwicmVtb3ZlIiwiJHAiLCIkb3JkZXIiLCJlZGl0b3JfaWQiLCJvcmlnIiwiY3VyciIsImluZGV4IiwibmFtZSIsInJlcGxhY2UiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJDQU9BLFNBQVlBLEdBRVhDLE9BQU9DLEtBQU9ELE9BQU9DLE1BQVEsR0FFN0JELE9BQU9DLEtBQUtDLGdCQUFrQixXQU83QkMsS0FBS0MsUUFBVUMsS0FBS0MsTUFBeUIsS0FBaEJELEtBQUtFLFNBQW9CLEtBU3RESixLQUFLSyxLQUFPLFdBRVhMLEtBQUtNLGtCQUVMLElBQUlDLEVBQU1YLEVBQUcseURBRWIsR0FBT1csRUFBSUMsT0FBWCxDQUlBQyxLQUFLQyxRQUFRQyxNQUFPSixHQUlwQixJQUVDSyxFQUZHQyxFQUFPYixLQUNWYyxFQUFVLEVBR1hGLEVBQVdHLFlBQWEsV0FHdkIsR0FBZ0IsS0FBWEQsRUFFSlAsRUFBSVMsS0FBTVAsS0FBS1EsS0FBS0MsVUFBVyw4RUFJM0IsQ0FBQSxHQUFLLG9CQUF1QkMsUUFHaEMsWUFEQUwsSUFPQUQsRUFBS08sT0FJTkMsY0FBZVQsR0FDZkgsS0FBS0MsUUFBUVksS0FBTWYsSUFFakIsT0FXSlAsS0FBS29CLEtBQU8sV0FFWCxJQUFJUCxFQUFPYixLQUlYSixFQUFHLDJCQUE0QjJCLEdBQUksUUFBUyxXQUMzQzNCLEVBQUcsWUFBYTRCLFFBQVMsV0FJMUI1QixFQUFHLHNCQUF1QjJCLEdBQUksU0FBVSx1QkFBd0IsV0FDL0RW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a0MsY0FBY0MsWUFBYSxtQkFBbUIsRUFBTXFELEdBRzVERixFQUFHN0QsS0FBTSwyQkFBNEJXLEtBQU0sV0FFMUMsSUFBSXdELEVBQU9uSCxFQUFHSSxNQUFPOEIsS0FBTSxRQUN0QmlGLEdBQ0puSCxFQUFHSSxNQUFPOEIsS0FBTSxPQUFRaUYsRUFBS0MsUUFBU0osRUFBTUMsTUFNOUMxRixRQUFRa0MsY0FBY0MsWUFBYSxnQkFBZ0IsRUFBTXFELEdBRXpERCxFQUFPN0QsSUFBS2dFLE1BT2Q3RyxLQUFLSyxRQUlFLElBQUlSLE9BQU9DLEtBQUtDLGdCQXpnQnpCLENBMmdCS2tIIiwiZmlsZSI6ImxsbXMtbWV0YWJveC1wcm9kdWN0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUHJvZHVjdCBPcHRpb25zIE1ldGFCb3hcbiAqIERpc3BsYXlzIG9uIENvdXJzZSAmIE1lbWJlcnNoaXAgUG9zdCBUeXBlc1xuICpcbiAqIEBzaW5jZSAgICAzLjAuMFxuICogQHZlcnNpb24gIDMuNi4wXG4gKi9cbiggZnVuY3Rpb24oICQgKSB7XG5cblx0d2luZG93LmxsbXMgPSB3aW5kb3cubGxtcyB8fCB7fTtcblxuXHR3aW5kb3cubGxtcy5tZXRhYm94X3Byb2R1Y3QgPSBmdW5jdGlvbigpIHtcblxuXHRcdC8qKlxuXHRcdCAqIEEgcmFuZG9tbHkgZ2VuZXJhdGVkIHRlbXBvcmFyeSBJRCB1c2VkIGZvciB0aGUgdGlueU1DRSBlZGl0b3IncyBpZFxuXHRcdCAqIHdoZW4gYSBuZXcgcGxhbiBpcyBhZGRlZFxuXHRcdCAqIEB0eXBlIGludFxuXHRcdCAqL1xuXHRcdHRoaXMudGVtcF9pZCA9IE1hdGguZmxvb3IoICggTWF0aC5yYW5kb20oKSAqIDc3NzcgKSArIDc3NyApO1xuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGlhbGl6ZVxuXHRcdCAqXG5cdFx0ICogQHJldHVybiAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gMy42LjBcblx0XHQgKi9cblx0XHR0aGlzLmluaXQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dGhpcy5iaW5kX3Zpc2liaWxpdHkoKTtcblxuXHRcdFx0dmFyICRtYiA9ICQoICcjbGlmdGVybG1zLXByb2R1Y3QgI2xsbXMtcHJvZHVjdC1vcHRpb25zLWFjY2Vzcy1wbGFucycgKTtcblxuXHRcdFx0aWYgKCAhICRtYi5sZW5ndGggKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0TExNUy5TcGlubmVyLnN0YXJ0KCAkbWIgKTtcblxuXHRcdFx0Ly8gd2UgcmVseSBvbiBUaW55TUNFIGJ1dCBXb3JkUHJlc3MgZG9lc24ndCByZWdpc3RlciBUaW55TUNFXG5cdFx0XHQvLyBsaWtlIGV2ZXJ5IG90aGVyIGFkbWluIHNjcmlwdCBzbyB3ZSdsbCBkbyBhIGxpdHRsZSBkZXBlbmRlbmN5IGNoZWNrIGhlcmUuLi5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0Y291bnRlciA9IDAsXG5cdFx0XHRcdGludGVydmFsO1xuXG5cdFx0XHRpbnRlcnZhbCA9IHNldEludGVydmFsKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHQvLyBpZiB3ZSBnZXQgdG8gMzAgc2Vjb25kcyBkaXNwbGF5IGFuIGVycm9yIG1lc3NhZ2Vcblx0XHRcdFx0aWYgKCBjb3VudGVyID49IDMwMCApIHtcblxuXHRcdFx0XHRcdCRtYi5odG1sKCBMTE1TLmwxMG4udHJhbnNsYXRlKCAnVGhlcmUgd2FzIGFuIGVycm9yIGxvYWRpbmcgdGhlIG5lY2Vzc2FyeSByZXNvdXJjZXMuIFBsZWFzZSB0cnkgYWdhaW4uJyApICk7XG5cblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBpZiB3ZSBjYW4ndCBhY2Nlc3MgdGlueU1DRSwgaW5jcmVtZW50IGFuZCB3YWl0Li4uXG5cdFx0XHRcdGVsc2UgaWYgKCAndW5kZWZpbmVkJyA9PT0gdHlwZW9mIHRpbnlNQ0UgKSB7XG5cblx0XHRcdFx0XHRjb3VudGVyKys7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gYmluZCB0aGUgZXZlbnRzLCB3ZSdyZSBnb29kIVxuXHRcdFx0XHRlbHNlIHtcblxuXHRcdFx0XHRcdHNlbGYuYmluZCgpO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjbGVhckludGVydmFsKCBpbnRlcnZhbCApO1xuXHRcdFx0XHRMTE1TLlNwaW5uZXIuc3RvcCggJG1iICk7XG5cblx0XHRcdH0sIDEwMCApO1xuXG5cdFx0fTtcblxuXG5cdFx0LyoqXG5cdFx0ICogQmluZCBET00gRXZlbnRzXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKiBAc2luY2UgIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5iaW5kID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0Ly8gc2F2ZSBhY2Nlc3MgcGxhbnMgYnV0dG9uXG5cdFx0XHQvLyBAdG9kbyBjb252ZXJ0IHRvIGFqYXggbWV0aG9kIHRoYXQgZG9lc24ndCByZWxvYWQgdGhlIHdob2xlIGRlYWxpZVxuXHRcdFx0JCggJyNsbG1zLXNhdmUtYWNjZXNzLXBsYW5zJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0JCggJyNwdWJsaXNoJyApLnRyaWdnZXIoICdjbGljaycgKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gYmluZCBjaGFuZ2UgZXZlbnRzIHRvIGZvcm0gZWxlbWVudCB0aGF0IGNvbnRyb2xzIGFub3RoZXIgZm9ybSBlbGVtZW50XG5cdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApLm9uKCAnY2hhbmdlJywgJ1tkYXRhLWNvbnRyb2xsZXItaWRdJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHNlbGYuY29udHJvbGxlcl9jaGFuZ2UoICQoIHRoaXMgKSApO1xuXHRcdFx0fSApXG5cblx0XHRcdCQoICcjbGxtcy1hY2Nlc3MtcGxhbnMgLmxsbXMtYWNjZXNzLXBsYW4tZGF0ZXBpY2tlcicgKS5kYXRlcGlja2VyKCB7XG5cdFx0XHRcdGRhdGVGb3JtYXQ6IFwibW0vZGQveXlcIlxuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyB0cmlnZ2VyIGNoYW5nZXMgb24gbG9hZCBmb3IgYWxsIGV4aXN0aW5nIHBsYW5zXG5cdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIFtkYXRhLWNvbnRyb2xsZXItaWRdJyApLnRyaWdnZXIoICdjaGFuZ2UnICk7XG5cblx0XHRcdC8vIGFkZCBhIG5ldyBlbXB0eSBwbGFuIGludGVyZmFjZSBvbiBuZXcgcGxhbiBidXR0b24gY2xpY2tcblx0XHRcdCQoICcjbGxtcy1uZXctYWNjZXNzLXBsYW4nICkub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgJGVsID0gJCggdGhpcyApO1xuXHRcdFx0XHRzZWxmLmluaXRfcGxhbigpO1xuXHRcdFx0XHQkZWwuYXR0ciggJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyApO1xuXHRcdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkZWwucmVtb3ZlQXR0ciggJ2Rpc2FibGVkJyApO1xuXHRcdFx0XHR9LCA1MDAgKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucycgKS5zb3J0YWJsZSgge1xuXHRcdFx0XHRoYW5kbGU6ICcubGxtcy1kcmFnLWhhbmRsZScsXG5cdFx0XHRcdGl0ZW1zOiAnLmxsbXMtYWNjZXNzLXBsYW4nLFxuXHRcdFx0XHRzdGFydDogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHtcblx0XHRcdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApLmFkZENsYXNzKCAnZHJhZ2dpbmcnICk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHN0b3A6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7XG5cdFx0XHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucycgKS5yZW1vdmVDbGFzcyggJ2RyYWdnaW5nJyApO1xuXHRcdFx0XHRcdHNlbGYudXBkYXRlX3BsYW5fb3JkZXJzKCk7XG5cdFx0XHRcdH0sXG5cdFx0XHR9ICk7XG5cblx0XHRcdC8vIGJpbmQgdGV4dCBlbnRlcmVkIGludG8gdGhlIHRpdGxlIHRvIHRoZSBkaXNwbGF5ZWQgdGl0bGUgZm9yIGZhbmN5IGZ1blxuXHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucycgKS5vbiggJ2tleXVwJywgJ2lucHV0LmxsbXMtcGxhbi10aXRsZScsIGZ1bmN0aW9uKCApIHtcblxuXHRcdFx0XHR2YXIgJGlucHV0ID0gJCggdGhpcyApLFxuXHRcdFx0XHRcdCRwbGFuID0gJGlucHV0LmNsb3Nlc3QoICcubGxtcy1hY2Nlc3MtcGxhbicgKSxcblx0XHRcdFx0XHQkZGlzcGxheSA9ICRwbGFuLmZpbmQoICdzcGFuLmxsbXMtcGxhbi10aXRsZScgKSxcblx0XHRcdFx0XHR2YWwgPSAkaW5wdXQudmFsKCksXG5cdFx0XHRcdFx0dGl0bGUgPSAoIHZhbCApID8gdmFsIDogJGRpc3BsYXkuYXR0ciggJ2RhdGEtZGVmYXVsdCcgKTtcblxuXHRcdFx0XHQkZGlzcGxheS50ZXh0KCB0aXRsZSApO1xuXG5cdFx0XHR9ICk7XG5cblxuXHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucycgKS5vbiggJ2NsaWNrJywgJy5sbG1zLXBsYW4tZGVsZXRlJywgZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdHNlbGYuZGVsZXRlX3BsYW4oICQoIHRoaXMgKSApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBzZWxlY3QyaWZ5IG1lbWJlcnNoaXAgYXZhaWxhYmlsaXR5IGZpZWxkc1xuXHRcdFx0d2luZG93LmxsbXMubWV0YWJveGVzLnBvc3Rfc2VsZWN0KCAkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIC5sbG1zLWF2YWlsYWJpbGl0eS1yZXN0cmljdGlvbnMnICkgKTtcblxuXHRcdFx0Ly8gZGlzYWJsZSB0aGUgdGV4dGFyZWEgZ2VuZXJhdGVkIGJ5IHRoZSB3cF9lZGl0b3IgZnVuY3Rpb25cblx0XHRcdC8vIGNhbid0IGZpZ3VyZSBvdXQgaG93IHRvIGRvIHRoaXMgZHVyaW5nIGluaXRpYWxpemF0aW9uXG5cdFx0XHQkKCAnI19sbG1zX3BsYW5zX2NvbnRlbnRfbGxtcy1uZXctYWNjZXNzLXBsYW4tbW9kZWwnICkuYXR0ciggJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyApO1xuXHRcdFx0dGlueU1DRS5FZGl0b3JNYW5hZ2VyLmV4ZWNDb21tYW5kKCAnbWNlUmVtb3ZlRWRpdG9yJywgdHJ1ZSwgJ19sbG1zX3BsYW5zX2NvbnRlbnRfbGxtcy1uZXctYWNjZXNzLXBsYW4tbW9kZWwnICk7XG5cblx0XHRcdC8vIHdoZW4gdGhlIHB1Ymxpc2ggYnV0dG9uIGlzIGNsaWNrZWQgbG9vcCB0aHJvdWdoIGFsbCBwbGFuIGlucHV0c1xuXHRcdFx0Ly8gd2hpY2ggbWlnaHQgaGF2ZSB2YWxpZGF0aW9uIGVycm9ycyB1bnRpbCB3ZSBmaW5kIGFuIGVycm9yLCBpZiB3ZSBkb24ndCBmaW5kIG9uZSwgaXQgZ2V0J3MgcHVibGlzaGVkXG5cdFx0XHQkKCAnI3B1Ymxpc2gnICkub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXG5cdFx0XHRcdC8vIGxvb3Bcblx0XHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucyBpbnB1dCcgKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHRcdC8vIGlmIHRoZSBmaWVsZCBpcyBpbnZhbGlkXG5cdFx0XHRcdFx0aWYgKCAkKCB0aGlzICkuaXMoICc6aW52YWxpZCcgKSApIHtcblx0XHRcdFx0XHRcdHZhciAkcGxhbiA9ICQoIHRoaXMgKS5jbG9zZXN0KCAnLmxsbXMtYWNjZXNzLXBsYW4nICk7XG5cdFx0XHRcdFx0XHQvLyBjaGVjayBpZiB0aGUgcGxhbiBpcyBvcGVuLCBvcGVuIGlmIGl0J3Mgbm90XG5cdFx0XHRcdFx0XHRpZiAoICEgJHBsYW4uaGFzQ2xhc3MoICdvcGVuZWQnICkgKSB7XG5cdFx0XHRcdFx0XHRcdCRwbGFuLmZpbmQoICcubGxtcy1jb2xsYXBzaWJsZS1oZWFkZXInICkudHJpZ2dlciggJ2NsaWNrJyApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0Ly8gZXhpdCB0aGUgbG9vcCByZWdhcmRsZXNzIGJjIHRoZSBlcnJvciBtc2cgd2lsbCBub3cgYmUgdmlzaWJsZVxuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9ICk7XG5cblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBCaW5kIERPTSBldmVudHMgZm9yIGVkaXRpbmcgcHJvZHVjdCB2aXNpYmlsaXR5XG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy42LjBcblx0XHQgKiBAdmVyc2lvbiAgMy42LjBcblx0XHQgKi9cblx0XHR0aGlzLmJpbmRfdmlzaWJpbGl0eSA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgJHJhZGlvcyA9ICQoICcjbGxtcy1jYXRhbG9nLXZpc2liaWxpdHktc2VsZWN0JyApLFxuXHRcdFx0XHQkdG9nZ2xlID0gJCggJ2EubGxtcy1lZGl0LWNhdGFsb2ctdmlzaWJpbGl0eScgKSxcblx0XHRcdFx0JHNhdmUgPSAkKCAnYS5sbG1zLXNhdmUtY2F0YWxvZy12aXNpYmlsaXR5JyApLFxuXHRcdFx0XHQkY2FuY2VsID0gICQoICdhLmxsbXMtY2FuY2VsLWNhdGFsb2ctdmlzaWJpbGl0eScgKTtcblxuXHRcdFx0JHRvZ2dsZS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0JHJhZGlvcy5zbGlkZURvd24oICdmYXN0JyApO1xuXHRcdFx0XHQkdG9nZ2xlLmhpZGUoKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0JHNhdmUub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCRyYWRpb3Muc2xpZGVVcCggJ2Zhc3QnICk7XG5cdFx0XHRcdCR0b2dnbGUuc2hvdygpO1xuXHRcdFx0XHQkKCAnI2xsbXMtY2F0YWxvZy12aXNpYmlsaXR5LWRpc3BsYXknICkudGV4dCggJCggJ2lucHV0W25hbWU9XCJfbGxtc192aXNpYmlsaXR5XCJdOmNoZWNrZWQnICkuYXR0ciggJ2RhdGEtbGFiZWwnICkgKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0JGNhbmNlbC5vbiggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0JHJhZGlvcy5zbGlkZVVwKCAnZmFzdCcgKTtcblx0XHRcdFx0JHRvZ2dsZS5zaG93KCk7XG5cdFx0XHR9ICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogSGFuZGxlIHBoeXNpY2FsIGRlbGV0aW9uIG9mIGEgcGxhbiBlbGVtZW50XG5cdFx0ICogSWYgdGhlIHBsYW4gaGFzbid0IGJlIHBlcnNpc3RlZCB0byB0aGUgZGF0YWJzZSBpdCdzIHJlbW92ZWQgZnJvbSB0aGUgZG9tXG5cdFx0ICogaWYgaXQgYWxyZWFkeSBleGlzdHMgaW4gdGhlIGRhdGFiYXNlIGEgY29uZmlybSBtb2RhbCBpcyBkaXNwbGF5ZWRcblx0XHQgKiB1cG9uIGNvbmZpcm1hdGlvbiBBSkFYIGNhbGwgd2lsbCBiZSBtYWRlIHRvIG1vdmUgdGhlIHBsYW4gdG8gdGhlIHRyYXNoXG5cdFx0ICogYW5kIHVwb24gc3VjY2VzcyB0aGUgZWxlbWVudCB3aWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgZG9tXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gIG9iaiAkYnRuIGpRdWVyeSBzZWxlY3RvciBvZiB0aGUgXCJYXCIgYnV0dG9uIGNsaWNrZWQgdG8gaW5pdGlhdGUgZGVsZXRpb25cblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKiBAc2luY2UgIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5kZWxldGVfcGxhbiA9IGZ1bmN0aW9uKCAkYnRuICkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdCRwbGFuID0gJGJ0bi5jbG9zZXN0KCAnLmxsbXMtYWNjZXNzLXBsYW4nICksXG5cdFx0XHRcdHBsYW5faWQgPSAkcGxhbi5hdHRyKCAnZGF0YS1pZCcgKTtcblxuXHRcdFx0Ly8gaWYgdGhlcmUncyBubyBJRCBqdXN0IHJlbW92ZSB0aGUgZWxlbWVudCBmcm9tIHRoZSBET01cblx0XHRcdGlmICggISBwbGFuX2lkICkge1xuXHRcdFx0XHRzZWxmLnJlbW92ZV9wbGFuX2VsKCAkcGxhbiApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyB0cmlnZ2VyIGEgdG9wTW9kYWwgc28gd2UgY2FuIHdhcm4gYW5kIGNvbmZpcm0gZGVsZXRpb24gb2YgdGhlIHBsYW5cblx0XHRcdGVsc2Uge1xuXG5cdFx0XHRcdCQoICcjbGxtcy1kZWxldGUtcGxhbi1tb2RhbCcgKS50b3BNb2RhbCgge1xuXHRcdFx0XHRcdG9wZW46IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0Ly8gYXR0YWNoIGFuIGV2ZW50IGhhbmRsZXIgdG8gdGhlIGRlbCBidXR0b24gdG8gYWN0dWFsbHkgZGVsZXRlIHRoZSB0aGluZ1xuXHRcdFx0XHRcdFx0JCggJyNsbG1zLWNvbmZpcm0tZGVsZXRlLXBsYW4nICkub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdFx0XHRcdExMTVMuU3Bpbm5lci5zdGFydCggJHBsYW4sICdzbWFsbCcgKTtcblxuXHRcdFx0XHRcdFx0XHQkKCAnI2xsbXMtZGVsZXRlLXBsYW4tbW9kYWwgLnRvcE1vZGFsQ2xvc2UnICkudHJpZ2dlciggJ2NsaWNrJyApO1xuXG5cdFx0XHRcdFx0XHRcdHdpbmRvdy5MTE1TLkFqYXguY2FsbCgge1xuXHRcdFx0XHRcdFx0XHRcdGRhdGE6IHtcblx0XHRcdFx0XHRcdFx0XHRcdGFjdGlvbjogJ2RlbGV0ZV9hY2Nlc3NfcGxhbicsXG5cdFx0XHRcdFx0XHRcdFx0XHRwbGFuX2lkOiBwbGFuX2lkLFxuXHRcdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24oIHIgKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRcdExMTVMuU3Bpbm5lci5zdG9wKCAkcGxhbiApO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoIHIuc3VjY2VzcyApIHtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRzZWxmLnJlbW92ZV9wbGFuX2VsKCAkcGxhbiApO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKCByLm1lc3NhZ2UgKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0YWxlcnQoIHIubWVzc2FnZSApO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0fSApO1xuXG5cblxuXHRcdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Y2xvc2VkOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdC8vIHJlbW92ZSB0aGUgaWRcblx0XHRcdFx0XHRcdCQoICcjbGxtcy1kZWxldGUtcGxhbi1tb2RhbCcgKS5hdHRyKCAnZGF0YS1wbGFuLWlkJywgJycgKTtcblxuXHRcdFx0XHRcdFx0Ly8gcmVtb3ZlIGNsaWNrIGhhbmRsZXJzXG5cdFx0XHRcdFx0XHQkKCAnI2xsbXMtY29uZmlybS1kZWxldGUtcGxhbicgKS5vZmYoICdjbGljaycgKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9ICkuYXR0ciggJ2RhdGEtcGxhbi1pZCcsIHBsYW5faWQgKTtcblx0XHRcdH1cblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBIYW5kbGUgaGlkaW5nICYgc2hvd2luZyB2YXJpb3MgcGllY2VzIG9mIGFuIGFjY2VzcyBwbGFuIGZvcm1cblx0XHQgKiBUaGlzIGlzIGJvdW5kIHRvIGFueSBmb3JtIGVsZW1lbnQgd2l0aCBhIFwiZGF0YS1jb250cm9sbGVyLWlkXCIgcHJvcGVydHlcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgb2JqICAkZWwgICBqUXVlcnkgc2VsZWN0b3IgZm9yIHRoZSBjaGFuZ2VkIGZvcm0gZWxlbWVudFxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmNvbnRyb2xsZXJfY2hhbmdlID0gZnVuY3Rpb24oICRlbCApIHtcblxuXHRcdFx0dmFyIGlkID0gJGVsLmF0dHIoICdkYXRhLWNvbnRyb2xsZXItaWQnICksXG5cdFx0XHRcdHZhbCA9ICRlbC52YWwoKSxcblx0XHRcdFx0JGZvcm0gPSAkZWwuY2xvc2VzdCggJy5sbG1zLWFjY2Vzcy1wbGFuJyApLFxuXHRcdFx0XHQkY29udHJvbHMgPSAkZm9ybS5maW5kKCAnW2RhdGEtY29udHJvbGxlcj1cIicgKyBpZCArICdcIl0nKTtcblxuXHRcdFx0aWYgKCAnY2hlY2tib3gnID09PSAkZWwuYXR0ciggJ3R5cGUnICkgKSAge1xuXHRcdFx0XHR2YWwgPSAoICRlbC5pcyggJzpjaGVja2VkJyApICkgPyB2YWwgOiAnbm8nO1xuXHRcdFx0fVxuXG5cdFx0XHQkY29udHJvbHMuZWFjaCggZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0dmFyICRjID0gJCggdGhpcyApLFxuXHRcdFx0XHRcdCRlbHMgPSAoICdTRUxFQ1QnID09PSAkY1swXS5ub2RlTmFtZSB8fCAnSU5QVVQnICA9PT0gJGNbMF0ubm9kZU5hbWUgfHwgJ1RFWFRBUkVBJyAgPT09ICRjWzBdLm5vZGVOYW1lICkgPyAkYyA6ICRjLmZpbmQoICdpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYScgKSxcblx0XHRcdFx0XHRlcXVhbHMgPSAkYy5hdHRyKCAnZGF0YS12YWx1ZS1pcycgKSxcblx0XHRcdFx0XHRub3RfZXF1YWxzID0gJGMuYXR0ciggJ2RhdGEtdmFsdWUtaXMtbm90JyApLFxuXHRcdFx0XHRcdGFjdGlvbiwgb3BlcmF0b3I7XG5cblx0XHRcdFx0aWYgKCB0eXBlb2YgZXF1YWxzICE9PSB0eXBlb2YgdW5kZWZpbmVkICYmIGVxdWFscyAhPT0gZmFsc2UgKSB7XG5cblx0XHRcdFx0XHRvcGVyYXRvciA9ICc9PSc7XG5cblx0XHRcdFx0fSBlbHNlIGlmICggdHlwZW9mIG5vdF9lcXVhbHMgIT09IHR5cGVvZiB1bmRlZmluZWQgJiYgbm90X2VxdWFscyAhPT0gZmFsc2UgKSB7XG5cblx0XHRcdFx0XHRvcGVyYXRvciA9ICchPSc7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHN3aXRjaCAoIG9wZXJhdG9yICkge1xuXG5cdFx0XHRcdFx0Y2FzZSAnPT0nOlxuXG5cdFx0XHRcdFx0XHRpZiAoIHZhbCA9PSBlcXVhbHMgKSB7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9ICdzaG93Jztcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9ICdoaWRlJztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAnIT0nOlxuXG5cdFx0XHRcdFx0XHRpZiAoIHZhbCAhPSBub3RfZXF1YWxzICkge1xuXHRcdFx0XHRcdFx0XHRhY3Rpb24gPSAnc2hvdyc7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRhY3Rpb24gPSAnaGlkZSc7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCAnc2hvdycgPT09IGFjdGlvbiApIHtcblx0XHRcdFx0XHQkYy5zaG93KCk7XG5cdFx0XHRcdFx0JGVscy5yZW1vdmVBdHRyKCAnZGlzYWJsZWQnICkudHJpZ2dlciggJ2NoYW5nZScgKTtcblx0XHRcdFx0fSBlbHNlIGlmICggJ2hpZGUnID09PSBhY3Rpb24gKSB7XG5cdFx0XHRcdFx0JGMuaGlkZSgpO1xuXHRcdFx0XHRcdCRlbHMuYXR0ciggJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyApO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBEZXRlcm1pbmUgaWYgdGhlIGFjY2VzcyBwbGFuIGxpbWl0IGhhcyBiZWVuIHJlYWNoZWRcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gQm9vbGVhbiAgICAgdHJ1ZSBpZiBpdCdzIGJlZW4gcmVhY2hlZCwgZmFsc2Ugb3RoZXJ3aXNlXG5cdFx0ICogQHNpbmNlICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBsaW1pdCA9IHdpbmRvdy5sbG1zLnByb2R1Y3QuYWNjZXNzX3BsYW5fbGltaXQsXG5cdFx0XHRcdGN1cnIgPSAkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIC5sbG1zLWFjY2Vzcy1wbGFuJyApLmxlbmd0aDtcblxuXHRcdFx0cmV0dXJuIGN1cnIgPj0gbGltaXQ7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGFsaXplcyBhIG5ldyBwbGFuIGFuZCBhZGRzIGl0IHRvIHRoZSBsaXN0IG9mIHBsYW5zIGluIHRoZSBET01cblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaW5pdF9wbGFuID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdC8vIGRvbid0IGRvIGFueXRoaW5nIGlmIHdlJ3ZlIHJlYWNoZWQgdGhlIHBsYW4gbGltaXRcblx0XHRcdGlmICggdGhpcy5oYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgJGNsb25lID0gJCggJyNsbG1zLW5ldy1hY2Nlc3MtcGxhbi1tb2RlbCcgKS5jbG9uZSgpXG5cdFx0XHRcdCRleGlzdGluZ19wbGFucyA9ICQoICcjbGxtcy1hY2Nlc3MtcGxhbnMgLmxsbXMtYWNjZXNzLXBsYW4nICksXG5cdFx0XHRcdCRlZGl0b3IgPSAkY2xvbmUuZmluZCggJyNfbGxtc19wbGFuc19jb250ZW50X2xsbXMtbmV3LWFjY2Vzcy1wbGFuLW1vZGVsJyApO1xuXG5cdFx0XHQvLyByZW1vdmUgSUQgZnJvbSB0aGUgaXRlbVxuXHRcdFx0JGNsb25lLnJlbW92ZUF0dHIoICdpZCcgKTtcblxuXHRcdFx0Ly8gZ2l2ZSBhIHRlbXBvcmFyeSBpZCB0byB0aGUgZWRpdG9yIGVsZW1lbnRcblx0XHRcdCRlZGl0b3IucmVtb3ZlQXR0ciggJ2lkJyApLmF0dHIoICdpZCcsICdfbGxtc19wbGFuc19jb250ZW50XycgKyB0aGlzLnRlbXBfaWQgKTtcblx0XHRcdHRoaXMudGVtcF9pZCsrOyAvLyBpbmNyZW1lbnQgdGhlIHRlbXBfaWQgSUQgc28gd2UgZG9uJ3QgdXNlIGl0IGFnYWluXG5cblxuXHRcdFx0Ly8gYWN0aXZhdGUgYWxsIGVsZW1lbnRzXG5cdFx0XHQkY2xvbmUuZmluZCggJ3NlbGVjdCwgaW5wdXQsIHRleHRhcmVhJyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCB0aGlzICkucmVtb3ZlQXR0ciggJ2Rpc2FibGVkJyApOyAvLyBlbmFibGVkIHRoZSBmaWVsZFxuXHRcdFx0fSApO1xuXG5cblx0XHRcdCRjbG9uZS5maW5kKCAnLmxsbXMtYWNjZXNzLXBsYW4tZGF0ZXBpY2tlcicgKS5kYXRlcGlja2VyKCB7XG5cdFx0XHRcdGRhdGVGb3JtYXQ6IFwibW0vZGQveXlcIlxuXHRcdFx0fSApO1xuXG5cdFx0XHQkY2xvbmUuYXBwZW5kVG8oICcjbGxtcy1hY2Nlc3MtcGxhbnMnICk7XG5cblx0XHRcdC8vIHJld3JpdGUgdGhlIG9yZGVyIG9mIGFsbCBlbGVtZW50c1xuXHRcdFx0dGhpcy51cGRhdGVfcGxhbl9vcmRlcnMoKTtcblxuXHRcdFx0JGNsb25lLmZpbmQoICcubGxtcy1jb2xsYXBzaWJsZS1oZWFkZXInICkudHJpZ2dlciggJ2NsaWNrJyApO1xuXG5cdFx0XHQvLyBjaGVjayBpZiB0aGUgbGltaXQgaGFzIGJlZW4gcmVhY2hlZCBhbmQgdG9nZ2xlIHRoZSBidXR0b24gaWYgaXQgaGFzXG5cdFx0XHRpZiAoIHRoaXMuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkKCkgKSB7XG5cdFx0XHRcdHRoaXMudG9nZ2xlX2NyZWF0ZV9idXR0b24oICdkaXNhYmxlJyApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzZWxlY3QyaWZ5IG1lbWJlcnNoaXAgYXZhaWxhYmlsaXR5IGZpZWxkXG5cdFx0XHR3aW5kb3cubGxtcy5tZXRhYm94ZXMucG9zdF9zZWxlY3QoICRjbG9uZS5maW5kKCAnLmxsbXMtYXZhaWxhYmlsaXR5LXJlc3RyaWN0aW9ucycgKSApO1xuXG5cdFx0XHQkY2xvbmUuZmluZCggJ1tkYXRhLWNvbnRyb2xsZXItaWRdJyApLnRyaWdnZXIoICdjaGFuZ2UnICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQ29udHJvbCB0aGUgc3RhdHVzIG9mIHRoZSBcIk5ldyBBY2Nlc3MgUGxhblwiIEJ1dHRvblxuXHRcdCAqIEVuYWJsZXMgLyBEaXNhYmxlcyB0aGUgYnV0dG9uIGFuZCBzaG93cyAvIGhpZGVzIHRoZSBhc3NvY2lhdGVkIG1lc3NhZ2Vcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgc3RyaW5nIHN0YXR1cyAgICBlbmFibGUgb3IgZGlzYWJsZVxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLnRvZ2dsZV9jcmVhdGVfYnV0dG9uID0gZnVuY3Rpb24oIHN0YXR1cyApIHtcblxuXHRcdFx0dmFyICRidG4gPSAkKCAnI2xsbXMtbmV3LWFjY2Vzcy1wbGFuJyApLFxuXHRcdFx0XHQkbXNnID0gJGJ0bi5uZXh0KCAncCcgKTtcblxuXHRcdFx0aWYgKCAnZGlzYWJsZScgPT09IHN0YXR1cyApIHtcblxuXHRcdFx0XHQkYnRuLmF0dHIoICdkaXNhYmxlZCcsICdkaXNhYmxlZCcgKTtcblx0XHRcdFx0JG1zZy5zaG93KCk7XG5cblx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0JGJ0bi5yZW1vdmVBdHRyKCAnZGlzYWJsZWQnICk7XG5cdFx0XHRcdCRtc2cuaGlkZSgpO1xuXG5cdFx0XHR9XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVmlzdWFsbHkgaGlkZSBhbmQgdGhlbiBwaHlzaWNhbGx5IHJlbW92ZSBhIHBsYW4gZWxlbWVudCBmcm9tIHRoZSBET01cblx0XHQgKiBBZGRpdGlvbmFsbHkgZGV0ZXJtaW5lcyBpZiB0aGUgTmV3IFBsYW4gQnV0dG9uIHNob3VsZCBiZSByZS1lbmFibGVkXG5cdFx0ICogYWZ0ZXIgZGVsZXRpb25cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgb2JqICAgJHBsYW4galF1ZXJ5IHNlbGVjdG9yIG9mIHRoZSBwbGFuIGVsZW1lbnRcblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKiBAc2luY2UgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLnJlbW92ZV9wbGFuX2VsID0gZnVuY3Rpb24oICRwbGFuICkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdC8vIGZhZGUgb3V0IG5pY2VseVxuXHRcdFx0JHBsYW4uZmFkZU91dCggNDAwICk7XG5cblx0XHRcdC8vIHJlbW92ZSBmcm9tIGRvbSBhZnRlciBpdCdzIGhpZGRlbiB2aXN1YWxseVxuXHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblxuXHRcdFx0XHQkcGxhbi5yZW1vdmUoKTtcblxuXHRcdFx0XHQvLyBjaGVjayBpZiB3ZSBuZWVkIHRvIHJlZW5hYmxlIHRoZSBjcmVhdGUgYnV0dG9uIGFuZCBoaWRlIHRoZSBtZXNzYWdlXG5cdFx0XHRcdGlmICggISBzZWxmLmhhc19wbGFuX2xpbWl0X2JlZW5fcmVhY2hlZCgpICkge1xuXHRcdFx0XHRcdHNlbGYudG9nZ2xlX2NyZWF0ZV9idXR0b24oICdlbmFibGUnICk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIDQ1MCApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJlb3JkZXIgdGhlIGFycmF5IGluZGV4ZXMgYW5kIHRoZSBtZW51IG9yZGVyIGhpZGRlbiBpbnB1dHNcblx0XHQgKiBDYWxsZWQgYnkgalF1ZXJ5IFVJIFNvcnRhYmxlIG9uIHNvcnQgY29tcGxldGlvblxuXHRcdCAqIEFsc28gY2FsbGVkIGFmdGVyIGFkZGluZyBhIG5ldyBwbGFuIHRvIHRoZSBET00gc28gdGhlIG5ld2VzdCBpdGVtIGlzIGFsd2F5c1xuXHRcdCAqIHBlcnNpc3RlZCBhcyB0aGUgbGFzdCBpbiB0aGUgZGF0YWJhc2UgaWYgbm8gVVggcmVvcmRlcnMgdGhlIGl0ZW1cblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLnVwZGF0ZV9wbGFuX29yZGVycyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIC5sbG1zLWFjY2Vzcy1wbGFuJyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdHZhciAkcCA9ICQoIHRoaXMgKSxcblx0XHRcdFx0XHQkb3JkZXIgPSAkcC5maW5kKCAnLnBsYW4tb3JkZXInICksXG5cdFx0XHRcdFx0JGVkaXRvciA9ICRwLmZpbmQoICd0ZXh0YXJlYVtpZF49XCJfbGxtc19wbGFuc19jb250ZW50X1wiXScgKSxcblx0XHRcdFx0XHRlZGl0b3JfaWQgPSAkZWRpdG9yLmF0dHIoICdpZCcgKSxcblx0XHRcdFx0XHRvcmlnID0gJG9yZGVyLnZhbCgpICogMSxcblx0XHRcdFx0XHRjdXJyID0gJHAuaW5kZXgoKTtcblxuXHRcdFx0XHQvLyBkZS1pbml0IHRpbnlNQ0UgZnJvbSB0aGUgZWRpdG9yXG5cdFx0XHRcdHRpbnlNQ0UuRWRpdG9yTWFuYWdlci5leGVjQ29tbWFuZCggJ21jZVJlbW92ZUVkaXRvcicsIHRydWUsIGVkaXRvcl9pZCApO1xuXG5cdFx0XHRcdC8vIHVwZGF0ZSB0aGUgb3JkZXIgb2YgZWFjaCBmaWVsZCBpbiB0aGUgcGxhblxuXHRcdFx0XHQkcC5maW5kKCAnc2VsZWN0LCBpbnB1dCwgdGV4dGFyZWEnICkuZWFjaCggZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0XHR2YXIgbmFtZSA9ICQoIHRoaXMgKS5hdHRyKCAnbmFtZScgKTtcblx0XHRcdFx0XHRpZiAoIG5hbWUgKSB7XG5cdFx0XHRcdFx0XHQkKCB0aGlzICkuYXR0ciggJ25hbWUnLCBuYW1lLnJlcGxhY2UoIG9yaWcsIGN1cnIgKSApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0Ly8gcmUtaW5pdCB0aW55TUNFIG9uIHRoZSBlZGl0b3Jcblx0XHRcdFx0dGlueU1DRS5FZGl0b3JNYW5hZ2VyLmV4ZWNDb21tYW5kKCAnbWNlQWRkRWRpdG9yJywgdHJ1ZSwgZWRpdG9yX2lkICk7XG5cblx0XHRcdFx0JG9yZGVyLnZhbCggY3VyciApO1xuXG5cdFx0XHR9ICk7XG5cblx0XHR9O1xuXG5cdFx0Ly8gZ29cblx0XHR0aGlzLmluaXQoKTtcblxuXHR9O1xuXG5cdHZhciBhID0gbmV3IHdpbmRvdy5sbG1zLm1ldGFib3hfcHJvZHVjdCgpO1xuXG59ICkoIGpRdWVyeSApO1xuIl19
